## ‚öôÔ∏è Kovcheg: –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –î–µ–ø–ª–æ–π–º–µ–Ω—Ç

Kovcheg ‚Äî —Ü–µ –∞–≤—Ç–æ–Ω–æ–º–Ω–∞ –æ—Ñ–ª–∞–π–Ω-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è, —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó —Ç–∞ –ø–æ—à—É–∫—É –∑–Ω–∞–Ω—å. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ —è–∫ –º–æ–¥—É–ª—å–Ω–∏–π, CPU-–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Å—Ç–µ–∫, —ñ–¥–µ–∞–ª—å–Ω–∏–π –¥–ª—è —Ä–æ–±–æ—Ç–∏ –≤ **air-gapped** —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö —á–µ—Ä–µ–∑ Docker.

### I. üß± –û–≥–ª—è–¥ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –°–∏—Å—Ç–µ–º–∏

Kovcheg –ø—Ä–∞—Ü—é—î —è–∫ –∫–æ–Ω–≤–µ—î—Ä: **–Ü–Ω–≥–µ—Å—Ç** $\rightarrow$ **–Ü–Ω–¥–µ–∫—Å** $\rightarrow$ **RAG-–¥–≤–∏–∂–æ–∫** $\rightarrow$ **UI/API** $\rightarrow$ **–ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è**.

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å | –ö–ª—é—á–æ–≤—ñ –§—É–Ω–∫—Ü—ñ—ó |
| :--- | :--- | :--- |
| **`ark_format`** | –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—É –¥–∞–Ω–∏—Ö. | `schema`, `validation`, `signature_block`. |
| **`ark_engine`** | –Ø–¥—Ä–æ –æ–±—Ä–æ–±–∫–∏ –∑–Ω–∞–Ω—å. | `loader`, `builder/ingest` (PDF/DOCX $\rightarrow$ embeddings), `indexer`, `rag` (retrieval + LLM adapter). |
| **`ark_store`** | –õ–æ–∫–∞–ª—å–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç—ñ–≤. | `install`, `list`, `remove` –º–æ–¥—É–ª—ñ–≤ –∑–Ω–∞–Ω—å. |
| **`security`** | –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–ª—é—á–∞–º–∏ —Ç–∞ –ø—ñ–¥–ø–∏—Å–∞–º–∏. | `key management`, `signer`, `verifier`, `trusted store`. |
| **`web_ui`** | –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ API. | `FastAPI` (Backend: /ask, /modules) —Ç–∞ –ø—Ä–æ—Å—Ç–∏–π `Frontend` (SPA). |
| **`models_cache`** | –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –º–æ–¥–µ–ª–µ–π. | –õ–æ–∫–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ –≤–∞–≥—ñ–≤ LLM (GGUF) —Ç–∞ LoRA-–º–æ–¥–µ–ª–µ–π. |
| **`P2P / sync`** | **(–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)** | –ê–±—Å—Ç—Ä–∞–∫—Ü—ñ–π–Ω–∏–π –±–µ–∫–µ–Ω–¥ –¥–ª—è Syncthing/IPFS –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –º–æ–¥—É–ª—ñ–≤. |

-----

### II. üîÑ –ü–æ—Ç—ñ–∫ –î–∞–Ω–∏—Ö (Data Flow)

#### 1\. –Ü–Ω–≥–µ—Å—Ç —Ç–∞ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ú–æ–¥—É–ª—è (sources $\rightarrow$ .ark)

–¶–µ –ø—Ä–æ—Ü–µ—Å –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∏—Ä–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –Ω–∞ –∑–∞—Ö–∏—â–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–Ω–∞–Ω—å.

1.  **–î–∂–µ—Ä–µ–ª–æ:** –î–æ–∫—É–º–µ–Ω—Ç–∏ (PDF, DOCX, MD, TXT) —Ä–æ–∑–º—ñ—â—É—é—Ç—å—Å—è —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `sources/`.
2.  **MonsterLoader:** –í–∏–∫–æ–Ω—É—î **–≤–∏—Ç—è–≥ —Ç–µ–∫—Å—Ç—É** $\rightarrow$ **–æ—á–∏—â–µ–Ω–Ω—è** $\rightarrow$ **chunking** (500‚Äì1500 —Ç–æ–∫–µ–Ω—ñ–≤) $\rightarrow$ **–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è embeddings**.
3.  **Builder:** –ó–±–∏—Ä–∞—î `header`, `metadata`, `content` —ñ –∑–∞–ø–∏—Å—É—î `module.ark.json` (payload).
4.  **–ü—ñ–¥–ø–∏—Å:** –ö–æ–º–∞–Ω–¥–∞ `ark sign module.ark.json` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **Ed25519** –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è `signature_block`, —â–æ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

#### 2\. –Ü–Ω–¥–µ–∫—Å—É–≤–∞–Ω–Ω—è —Ç–∞ –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è

1.  **ArkStore:** –ö–æ–º–∞–Ω–¥–∞ `ark store install module.ark.json` **–ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø—ñ–¥–ø–∏—Å**.
2.  –ú–æ–¥—É–ª—å –∫–æ–ø—ñ—é—î—Ç—å—Å—è –¥–æ —Å—Ö–æ–≤–∏—â–∞: `~/.kovcheg/ark_store/packages/<id>/`.
3.  –§–∞–π–ª —ñ–Ω–¥–µ–∫—Å—É `index.json` –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º **–∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É** (atomic writes).

#### 3\. –ó–∞–ø–∏—Ç (RAG Query)

1.  **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á** –Ω–∞–¥—Å–∏–ª–∞—î –∑–∞–ø–∏—Ç —á–µ—Ä–µ–∑ `/ask` endpoint (Backend).
2.  **Backend:** `embed(query)` $\rightarrow$ **nearest-neighbors** –ø–æ—à—É–∫ (top-k) –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `FAISS`/`hnswlib` $\rightarrow$ **assemble prompt** –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º $\rightarrow$ `LLM.generate(prompt)`.
3.  **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –ü–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —Ä–∞–∑–æ–º —ñ–∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –Ω–∞ **chunk-–¥–∂–µ—Ä–µ–ª–∞**.

-----

### III. üîí –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å

#### –ë–µ–∑–ø–µ–∫–∞

  * **–¶–∏—Ñ—Ä–æ–≤—ñ –ü—ñ–¥–ø–∏—Å–∏ (Ed25519):** –ö–æ–∂–µ–Ω .ark –º–∞—î `signature_block`. –ü—Ä–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è `public key` —É —Ñ–∞–π–ª—ñ `trusted_publishers.json` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ç–∞ –¥–æ–≤—ñ—Ä–∏.
  * **–ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ö–ª—é—á—ñ–≤:** –ü—Ä–∏–≤–∞—Ç–Ω—ñ –∫–ª—é—á—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ `~/.kovcheg/security/keys/<publisher>/` —ñ–∑ –∑–∞—Ö–∏—â–µ–Ω–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É (**600**).
  * **Moderation Hook:** –ü–µ—Ä–µ–¥ –æ–±—Ä–æ–±–∫–æ—é –∑–∞–ø–∏—Ç—É (pre-inference) –≤–±—É–¥–æ–≤–∞–Ω–∏–π `moderation hook` (denylist + classifier) –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∑–∞–ø–∏—Ç–∏ –Ω–∞ —Ä–∏–∑–∏–∫–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç.
  * **Privacy:** –õ–æ–≥–∏ –Ω–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç.

#### –î–µ–ø–ª–æ–π–º–µ–Ω—Ç —Ç–∞ –û–ø–µ—Ä–∞—Ü—ñ—ó

Kovcheg –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Docker.

  * **Docker (–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ):**
    ```bash
    docker compose up -d --build
    ```
  * **–ö–ª—é—á–æ–≤—ñ Volumes:**
      * `./data:/app/data` (–ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤ `.ark`)
      * `./models_cache:/app/models_cache` (LLM –≤–∞–≥–∏)
      * `~/.kovcheg:/root/.kovcheg` (–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è, –∫–ª—é—á—ñ, store)
  * **Health Checks:**
      * `GET /health` (200 OK, –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å —Å–µ—Ä–≤—ñ—Å—ñ–≤)
      * `GET /metrics` (Prometheus metrics)
  * **Air-Gapped Environment:** –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —à–ª—è—Ö–æ–º —Ñ—ñ–∑–∏—á–Ω–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è Docker image, GGUF —Ñ–∞–π–ª—ñ–≤ –º–æ–¥–µ–ª–µ–π —Ç–∞ –ø–æ–¥–∞–ª—å—à–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–±–∏—Ä–∞–Ω–Ω—è (`ark build`) –∞–±–æ –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è (`ark sign`).

#### –†–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è (Backup & Restore)

–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å –∑–∞–±–µ–∑–ø–µ—á—É—î—Ç—å—Å—è –∞—Ä—Ö—ñ–≤–∞—Ü—ñ—î—é –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–∫—Ä–∏–ø—Ç—ñ–≤ (`scripts/backup.sh`, `scripts/restore.sh`). –†–µ–∑–µ—Ä–≤—É—é—Ç—å—Å—è: `ark_store/`, `models_cache/`, `security/keys/`.

#### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

  * **Unit Tests:** `pytest ark_engine/tests/`
  * **E2E (End-to-End):** –°–∫—Ä–∏–ø—Ç `scripts/e2e_demo.sh` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É: build $\rightarrow$ install $\rightarrow$ ask $\rightarrow$ validate.
  * **Security Tests:** –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–±–æ—ó–≤ –ø—Ä–∏ –ø—ñ–¥—Ä–æ–±—Ü—ñ —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –Ω–µ–≤—ñ—Ä–Ω–∏—Ö –∫–ª—é—á–∞—Ö.

-----

### IV. üìù –ö–ª—é—á–æ–≤–∞ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (ENV Variables)

| –ó–º—ñ–Ω–Ω–∞ | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –ó–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º |
| :--- | :--- | :--- |
| `API_HOST` | –•–æ—Å—Ç –¥–ª—è –∑–∞–ø—É—Å–∫—É FastAPI | `0.0.0.0` |
| `API_PORT` | –ü–æ—Ä—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ API | `8000` |
| `ARK_MODULES_PATH` | –®–ª—è—Ö –¥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤ | `/app/data` |
| `MODELS_PATH` | –®–ª—è—Ö –¥–æ –∫–µ—à—É –º–æ–¥–µ–ª–µ–π LLM | `/app/models_cache` |
| `TRUSTED_PUBLISHERS` | –®–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É trusted\_publishers.json | |
